# Bug Fixes - December 27, 2025

## Issues Fixed

### 1. url_str Undefined Error (chat.py)

**Problem**: Terminal showed errors about `url_str` not being defined.

**Root Cause**: The `json:` URL handler code was misplaced inside the `_combine_system_message()` method instead of being in the `on_anchor_clicked()` method where `url_str` is defined.

**Fix**: 
- Moved the `json:` handler into `on_anchor_clicked()` after the `copy:` handler
- Removed the misplaced code from `_combine_system_message()`

**Files Modified**: `gui/chat.py`

**Code Changes**:
```python
# In on_anchor_clicked(), after copy: handler:
elif url_str.startswith("json:"):
    try:
        msg_id = url_str.split(":", 1)[1]
        msg_index = int(msg_id)
        self.handle_json_message(msg_index)
    except Exception:
        pass
```

### 2. Diff Table Column Width Issue (batch_diff_dialog.py)

**Problem**: In the bottom diff panel, the "Original" column took up the entire view, requiring horizontal scrolling to see the "Modified" column.

**Root Cause**: The diff table had `table-layout: fixed` and `width: 100%`, but no explicit column widths were specified, causing the browser to allocate space unevenly.

**Fix**: Added explicit CSS column width rules:
- Line number columns (`.diff_next`): 2% each
- Content columns: 49% each
- This ensures both "Current" and "Proposed" columns are visible side-by-side

**Files Modified**: `gui/dialogs/batch_diff_dialog.py`

**Code Changes**:
```css
/* Column widths: line numbers narrow, content columns 50/50 */
table.diff col.diff_next {
    width: 2%;
}
table.diff col:not(.diff_next) {
    width: 49%;
}
```

## Testing

Both fixes have been applied and syntax-checked:
- `url_str` is now properly scoped and available for all URL handlers
- Diff table columns should display side-by-side with equal widths

## Outstanding Issue (Not Fixed)

**Model Loading Message**: The application always says the model isn't loaded, even when using the same model repeatedly. This is noted as a separate issue unrelated to diff handling and will need to be addressed in a future update.

**Impact**: Cosmetic only - doesn't affect functionality, but may cause unnecessary model reloading.

## Next Steps

1. Run the application and test batch diff dialog
2. Verify no more url_str errors appear in terminal
3. Check that diff columns display correctly (50/50 split)
4. Create separate issue for model loading message
